<%- include('header')%>
<div class="container">
  <div class="main-body">
    <div class="row">
      <div class="col-lg-4">
        <div class="card1" class="profile-options">
          <div class="card-body">
            <div class="d-flex flex-column align-items-center text-center">
              <img
                src="https://bootdey.com/img/Content/avatar/avatar6.png"
                alt="Admin"
                class="rounded-circle p-1 bg-dark"
                width="110"
              />
              <div class="mt-3">
                <h4><%= userdata.name %></h4>
              </div>
            </div>
            <hr class="my-4" />
            <ul class="list-group list-group-flush">
              <li
                class="list-group-item d-flex justify-content-between align-items-center flex-wrap"
              >
                <a href="/profile">Profile Information</a>
              </li>
              <li
                class="list-group-item d-flex justify-content-between align-items-center flex-wrap"
              >
                <a href="/address">Manage Addresses</a>
              </li>
              <li
                class="list-group-item d-flex justify-content-between align-items-center flex-wrap"
              >
                <a href="/order-history">My Orders</a>
              </li>
              <li
                class="list-group-item d-flex justify-content-between align-items-center flex-wrap"
              >
                <a href="/coupons">Coupons</a>
              </li>
              <li
                class="list-group-item d-flex justify-content-between align-items-center flex-wrap"
              >
                <a href="/wallet">My Wallet</a>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <div class="col-lg-8 user-coupons">
        <div id="copy-message"></div>
        <div class="coupon">
          <% coupons.forEach(coupon => { %>
          <div class="card mb-3">
            <div class="card-body">
              <h5 class="card-title">Coupon Code: <%= coupon.couponCode %></h5>
              <p class="card-text">Discount: <%= coupon.discount %>%</p>
              <p class="card-text">
                Expiry Date: <%= coupon.expiryDate.toISOString().split('T')[0]
                %>
              </p>
              <p class="card-text">Min Amount: <%= coupon.minAmount %></p>
              <p class="card-text">Max Amount: <%= coupon.maxAmount %></p>
              <!-- Add copy button for each coupon -->
              <button
                class="btn btn-sm btn-dark copy-button"
                data-coupon-code="<%= coupon.couponCode %>"
              >
                Copy Coupon
              </button>
            </div>
          </div>

          <% }); %>
        </div>
      </div>
    </div>
  </div>
</div>

<%- include('footer') %>

<script>
  // JavaScript code to handle copying coupon code
  document.addEventListener("DOMContentLoaded", function () {
    const copyButtons = document.querySelectorAll(".copy-button");

    copyButtons.forEach((button) => {
      button.addEventListener("click", function () {
        const couponCode = this.getAttribute("data-coupon-code");
        copyToClipboard(couponCode);
      });
    });

    function copyToClipboard(text) {
      const el = document.createElement("textarea");
      el.value = text;
      document.body.appendChild(el);
      el.select();
      document.execCommand("copy");
      document.body.removeChild(el);
      const messageContainer = document.getElementById("copy-message");
      messageContainer.textContent = "Coupon code copied to clipboard: " + text;
    }
  });
</script>
